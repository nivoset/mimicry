<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Step Flow - Test Site</title>
  <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
  <nav>
    <ul>
      <li><a href="../index.html">Home</a></li>
      <li><a href="multi-step-flow.html">Multi-Step Flow</a></li>
    </ul>
  </nav>

  <h1>Multi-Step Flow Test Page</h1>
  <p>This page tests wizard-style multi-page flows with progress indicators and state persistence.</p>

  <div class="card">
    <h2>Wizard Progress</h2>
    <div class="progress-bar">
      <div class="progress-fill" id="wizard-progress" style="width: 0%"></div>
    </div>
    <div id="step-indicators" style="display: flex; justify-content: space-between; margin-top: 1rem;">
      <div class="step-indicator active" data-step="1">Step 1</div>
      <div class="step-indicator" data-step="2">Step 2</div>
      <div class="step-indicator" data-step="3">Step 3</div>
      <div class="step-indicator" data-step="4">Step 4</div>
    </div>
  </div>

  <!-- Step 1: Welcome -->
  <div id="wizard-step-1" class="wizard-step active">
    <div class="card">
      <h2>Welcome to the Wizard</h2>
      <p>This is a multi-step wizard flow. Click "Next" to continue through each step.</p>
      <p>Your progress will be saved as you navigate between steps.</p>
      <button onclick="wizardNext()" class="btn">Start Wizard</button>
    </div>
  </div>

  <!-- Step 2: Information -->
  <div id="wizard-step-2" class="wizard-step hidden">
    <div class="card">
      <h2>Step 2: Provide Information</h2>
      <form id="wizard-form-2">
        <div class="form-group">
          <label for="wizard-name">Your Name</label>
          <input type="text" id="wizard-name" name="name" placeholder="Enter your name">
        </div>
        <div class="form-group">
          <label for="wizard-email">Your Email</label>
          <input type="email" id="wizard-email" name="email" placeholder="Enter your email">
        </div>
      </form>
      <button onclick="wizardPrevious()" class="btn secondary">Previous</button>
      <button onclick="wizardNext()" class="btn">Next</button>
    </div>
  </div>

  <!-- Step 3: Preferences -->
  <div id="wizard-step-3" class="wizard-step hidden">
    <div class="card">
      <h2>Step 3: Set Preferences</h2>
      <form id="wizard-form-3">
        <div class="form-group">
          <label>Choose your preferences:</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="pref" value="option1"> Option 1</label>
            <label><input type="checkbox" name="pref" value="option2"> Option 2</label>
            <label><input type="checkbox" name="pref" value="option3"> Option 3</label>
          </div>
        </div>
        <div class="form-group">
          <label for="wizard-theme">Theme Preference</label>
          <select id="wizard-theme" name="theme">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="auto">Auto</option>
          </select>
        </div>
      </form>
      <button onclick="wizardPrevious()" class="btn secondary">Previous</button>
      <button onclick="wizardNext()" class="btn">Next</button>
    </div>
  </div>

  <!-- Step 4: Review -->
  <div id="wizard-step-4" class="wizard-step hidden">
    <div class="card">
      <h2>Step 4: Review and Complete</h2>
      <div id="wizard-review">
        <p class="text-secondary">Review your information below:</p>
        <div id="review-content"></div>
      </div>
      <button onclick="wizardPrevious()" class="btn secondary">Previous</button>
      <button onclick="wizardComplete()" class="btn success">Complete Wizard</button>
    </div>
  </div>

  <!-- Completion Message -->
  <div id="wizard-complete" data-testid="wizard-complete" class="card hidden" role="status" aria-live="polite">
    <h2>Wizard Complete!</h2>
    <div class="alert success">
      <p>You have successfully completed the multi-step wizard.</p>
      <p>All your information has been saved.</p>
    </div>
    <button onclick="wizardReset()" class="btn">Start Over</button>
  </div>

  <style>
    .wizard-step {
      display: none;
    }

    .wizard-step.active {
      display: block;
    }

    .step-indicator {
      padding: 0.5rem 1rem;
      background-color: var(--bg-secondary);
      border-radius: var(--border-radius);
      color: var(--text-secondary);
      flex: 1;
      text-align: center;
      margin: 0 0.25rem;
    }

    .step-indicator.active {
      background-color: var(--primary-color);
      color: white;
    }

    .step-indicator.completed {
      background-color: var(--success-color);
      color: white;
    }
  </style>

  <script type="module">
    import { storage } from '../assets/js/utils.js';

    let currentWizardStep = 1;
    const totalWizardSteps = 4;
    const wizardData = {};

    // Load saved wizard state
    function loadWizardState() {
      const saved = storage('wizard_state');
      if (saved) {
        Object.assign(wizardData, saved.data);
        currentWizardStep = saved.step || 1;
        goToWizardStep(currentWizardStep);
      }
    }

    // Save wizard state
    function saveWizardState() {
      storage('wizard_state', {
        step: currentWizardStep,
        data: wizardData
      });
    }

    // Navigate to wizard step
    function goToWizardStep(step) {
      // Hide all steps
      for (let i = 1; i <= totalWizardSteps; i++) {
        const stepEl = document.getElementById(`wizard-step-${i}`);
        stepEl.classList.remove('active');
        stepEl.classList.add('hidden');
        
        const indicator = document.querySelector(`.step-indicator[data-step="${i}"]`);
        indicator.classList.remove('active', 'completed');
      }

      // Show current step
      document.getElementById(`wizard-step-${step}`).classList.remove('hidden');
      document.getElementById(`wizard-step-${step}`).classList.add('active');

      // Update indicators
      for (let i = 1; i < step; i++) {
        document.querySelector(`.step-indicator[data-step="${i}"]`).classList.add('completed');
      }
      document.querySelector(`.step-indicator[data-step="${step}"]`).classList.add('active');

      // Update progress bar
      const progress = (step / totalWizardSteps) * 100;
      document.getElementById('wizard-progress').style.width = `${progress}%`;

      // Save state
      saveWizardState();

      // Update review content on step 4
      if (step === 4) {
        updateReviewContent();
      }
    }

    // Collect data from current step
    function collectStepData(step) {
      const form = document.getElementById(`wizard-form-${step}`);
      if (form) {
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        
        // Handle checkboxes
        if (step === 3) {
          data.pref = formData.getAll('pref');
        }
        
        wizardData[`step${step}`] = data;
        saveWizardState();
      }
    }

    // Update review content
    function updateReviewContent() {
      const reviewDiv = document.getElementById('review-content');
      let html = '<ul>';
      
      Object.entries(wizardData).forEach(([key, value]) => {
        html += `<li><strong>${key}:</strong> ${JSON.stringify(value)}</li>`;
      });
      
      html += '</ul>';
      reviewDiv.innerHTML = html;
    }

    // Wizard navigation functions
    window.wizardNext = function() {
      collectStepData(currentWizardStep);
      if (currentWizardStep < totalWizardSteps) {
        currentWizardStep++;
        goToWizardStep(currentWizardStep);
      }
    };

    window.wizardPrevious = function() {
      if (currentWizardStep > 1) {
        collectStepData(currentWizardStep);
        currentWizardStep--;
        goToWizardStep(currentWizardStep);
      }
    };

    window.wizardComplete = function() {
      collectStepData(currentWizardStep);
      
      // Hide wizard steps
      for (let i = 1; i <= totalWizardSteps; i++) {
        document.getElementById(`wizard-step-${i}`).classList.add('hidden');
      }
      
      // Show completion message
      document.getElementById('wizard-complete').classList.remove('hidden');
      
      // Clear saved state
      localStorage.removeItem('wizard_state');
    };

    window.wizardReset = function() {
      currentWizardStep = 1;
      Object.keys(wizardData).forEach(key => delete wizardData[key]);
      localStorage.removeItem('wizard_state');
      
      document.getElementById('wizard-complete').classList.add('hidden');
      goToWizardStep(1);
    };

    // Initialize
    loadWizardState();
    if (currentWizardStep === 1) {
      goToWizardStep(1);
    }

  </script>
</body>
</html>
